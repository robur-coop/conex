<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conex_resource (conex.Conex_resource)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">conex</a> &#x00BB; Conex_resource</nav><header class="odoc-preamble"><h1>Module <code><span>Conex_resource</span></code></h1><p>Persistent data: on wire and record types</p><p>Every resource in conex is a piece of data (or metadata), and has its own purpose. Resources stored on disk consists of a common header: a name, a type, a counter, an epoch, and a creation timestamp. There are broadly three kinds of resources: those containing identities (<code>Team</code> and <code>Author</code>), those regulating access to packages (<code>Authorisation</code>), and those with the digests of the opam repository data (<code>Releases</code> and <code>Release</code>).</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#names-and-identifiers">Names and identifiers</a></li><li><a href="#wire-format">Wire format</a></li><li><a href="#resource-types">Resource types</a></li><li><a href="#digests">Digests</a></li><li><a href="#asymmetric-key-types">Asymmetric key types</a></li><li><a href="#cryptographic-signatures">Cryptographic signatures</a></li><li><a href="#root">Root</a></li><li><a href="#target">Target</a></li><li><a href="#timestamp">Timestamp</a></li><li><a href="#snapshot">Snapshot</a></li></ul></nav></div><div class="odoc-content"><h2 id="names-and-identifiers"><a href="#names-and-identifiers" class="anchor"></a>Names and identifiers</h2><div class="odoc-spec"><div class="spec type anchored" id="type-name"><a href="#type-name" class="anchor"></a><code><span><span class="keyword">type</span> name</span><span> = string</span></code></div><div class="spec-doc"><p>The name of resources, used e.g. for package names.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_name"><a href="#val-pp_name" class="anchor"></a><code><span><span class="keyword">val</span> pp_name : <span><a href="#type-name">name</a> <a href="../Conex_utils/index.html#type-fmt">Conex_utils.fmt</a></span></span></code></div><div class="spec-doc"><p><code>pp_name name</code> is a pretty printer for <code>name</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name_equal"><a href="#val-name_equal" class="anchor"></a><code><span><span class="keyword">val</span> name_equal : <span><a href="#type-name">name</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-name">name</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>name_equal a b</code> is the result of a case insensitive comparison of <code>a</code> and <code>b</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-identifier"><a href="#type-identifier" class="anchor"></a><code><span><span class="keyword">type</span> identifier</span><span> = string</span></code></div><div class="spec-doc"><p>The type of identifiers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_id"><a href="#val-pp_id" class="anchor"></a><code><span><span class="keyword">val</span> pp_id : <span><a href="#type-identifier">identifier</a> <a href="../Conex_utils/index.html#type-fmt">Conex_utils.fmt</a></span></span></code></div><div class="spec-doc"><p><code>pp_id id</code> is a pretty printer for <code>identifier</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-id_equal"><a href="#val-id_equal" class="anchor"></a><code><span><span class="keyword">val</span> id_equal : <span><a href="#type-identifier">identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-identifier">identifier</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>id_equal a b</code> is the result of a case insensitive comparison of <code>a</code> and <code>b</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-timestamp"><a href="#type-timestamp" class="anchor"></a><code><span><span class="keyword">type</span> timestamp</span><span> = string</span></code></div><div class="spec-doc"><p>The type for a timestamp, always a RFC3339 string in UTC (no timezone information).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_timestamp"><a href="#val-pp_timestamp" class="anchor"></a><code><span><span class="keyword">val</span> pp_timestamp : <span><a href="#type-timestamp">timestamp</a> <a href="../Conex_utils/index.html#type-fmt">Conex_utils.fmt</a></span></span></code></div></div><h2 id="wire-format"><a href="#wire-format" class="anchor"></a>Wire format</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Wire"><a href="#module-Wire" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Wire/index.html">Wire</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The wire encoding is abstract here, one suitable decoding and encoding engine is <a href="../Conex_opam_encoding/index.html"><code>Conex_opam_encoding</code></a>. The wire encoding is used for digest computations, and persistent storage on disk.</p></div></div><h2 id="resource-types"><a href="#resource-types" class="anchor"></a>Resource types</h2><div class="odoc-spec"><div class="spec type anchored" id="type-typ"><a href="#type-typ" class="anchor"></a><code><span><span class="keyword">type</span> typ</span><span> = </span><span>[ </span></code><ol><li id="type-typ.Root" class="def variant constructor anchored"><a href="#type-typ.Root" class="anchor"></a><code><span>| </span><span>`Root</span></code></li><li id="type-typ.Timestamp" class="def variant constructor anchored"><a href="#type-typ.Timestamp" class="anchor"></a><code><span>| </span><span>`Timestamp</span></code></li><li id="type-typ.Snapshot" class="def variant constructor anchored"><a href="#type-typ.Snapshot" class="anchor"></a><code><span>| </span><span>`Snapshot</span></code></li><li id="type-typ.Targets" class="def variant constructor anchored"><a href="#type-typ.Targets" class="anchor"></a><code><span>| </span><span>`Targets</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The sum type of all possible resources.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-typ_to_string"><a href="#val-typ_to_string" class="anchor"></a><code><span><span class="keyword">val</span> typ_to_string : <span><a href="#type-typ">typ</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>resource_to_string res</code> is the string representation of <code>res</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_to_typ"><a href="#val-string_to_typ" class="anchor"></a><code><span><span class="keyword">val</span> string_to_typ : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-typ">typ</a> option</span></span></code></div><div class="spec-doc"><p><code>string_to_resource str</code> is either <code>Some resource</code> or <code>None</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_typ"><a href="#val-pp_typ" class="anchor"></a><code><span><span class="keyword">val</span> pp_typ : <span><a href="#type-typ">typ</a> <a href="../Conex_utils/index.html#type-fmt">Conex_utils.fmt</a></span></span></code></div><div class="spec-doc"><p><code>pp_resource pp</code> is a pretty printer for <code>resource</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-typ_equal"><a href="#val-typ_equal" class="anchor"></a><code><span><span class="keyword">val</span> typ_equal : <span><a href="#type-typ">typ</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-typ">typ</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>resource_equal a b</code> is <code>true</code> if they are the same, otherwise <code>false</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-typ_of_wire"><a href="#val-typ_of_wire" class="anchor"></a><code><span><span class="keyword">val</span> typ_of_wire : <span><a href="Wire/index.html#type-s">Wire.s</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-typ">typ</a>, string)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-err"><a href="#type-err" class="anchor"></a><code><span><span class="keyword">type</span> err</span><span> = </span><span>[ </span></code><ol><li id="type-err.Parse" class="def variant constructor anchored"><a href="#type-err.Parse" class="anchor"></a><code><span>| </span><span>`Parse <span class="keyword">of</span> string</span></code></li><li id="type-err.Unknown_alg" class="def variant constructor anchored"><a href="#type-err.Unknown_alg" class="anchor"></a><code><span>| </span><span>`Unknown_alg <span class="keyword">of</span> string</span></code></li><li id="type-err.Malformed" class="def variant constructor anchored"><a href="#type-err.Malformed" class="anchor"></a><code><span>| </span><span>`Malformed</span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_err"><a href="#val-pp_err" class="anchor"></a><code><span><span class="keyword">val</span> pp_err : <span><a href="#type-err">err</a> <a href="../Conex_utils/index.html#type-fmt">Conex_utils.fmt</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Header"><a href="#module-Header" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Header/index.html">Header</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Common header on disk</p></div></div><h2 id="digests"><a href="#digests" class="anchor"></a>Digests</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Digest"><a href="#module-Digest" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Digest/index.html">Digest</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Digest_map"><a href="#module-Digest_map" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Digest_map/index.html">Digest_map</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="asymmetric-key-types"><a href="#asymmetric-key-types" class="anchor"></a>Asymmetric key types</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Key"><a href="#module-Key" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Key/index.html">Key</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="cryptographic-signatures"><a href="#cryptographic-signatures" class="anchor"></a>Cryptographic signatures</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Signature"><a href="#module-Signature" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Signature/index.html">Signature</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_be_signed"><a href="#val-to_be_signed" class="anchor"></a><code><span><span class="keyword">val</span> to_be_signed : <span><a href="Wire/index.html#type-t">Wire.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-timestamp">timestamp</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-identifier">identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Signature/index.html#type-alg">Signature.alg</a> <span class="arrow">&#45;&gt;</span></span> <a href="Wire/index.html#type-t">Wire.t</a></span></code></div><div class="spec-doc"><p><code>to_be_signed data timestamp id algorithm</code> prepares the representation used by signing and verification</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Expression"><a href="#module-Expression" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Expression/index.html">Expression</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="root"><a href="#root" class="anchor"></a>Root</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Root"><a href="#module-Root" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Root/index.html">Root</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The root contains the (offline) root keys, also defines snapshot, timestamp, and maintainers. Furthermore, it contains configuration information such as where keys are located in this repository and where the data is stored.</p></div></div><h2 id="target"><a href="#target" class="anchor"></a>Target</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Target"><a href="#module-Target" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Target/index.html">Target</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The target is a triple of filename, digest, and size. It is used by snapshot and targets.</p></div></div><h2 id="timestamp"><a href="#timestamp" class="anchor"></a>Timestamp</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Timestamp"><a href="#module-Timestamp" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Timestamp/index.html">Timestamp</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The timestamp is signed by the timestamp role. It lists the snapshot data, (its size, filename, and digest). The purpose is to prevent freeze attacks: It periodically signs the data, a client can discover it does not receive updates.</p></div></div><h2 id="snapshot"><a href="#snapshot" class="anchor"></a>Snapshot</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Snapshot"><a href="#module-Snapshot" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Snapshot/index.html">Snapshot</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The snapshot is signed by the snapshot role. It lists all targets, with size, filename, and digest. The purpose is to prevent mix-and-match attacks, where an attacker mixes older targets files with newer ones.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Delegation"><a href="#module-Delegation" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Delegation/index.html">Delegation</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Targets"><a href="#module-Targets" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Targets/index.html">Targets</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
